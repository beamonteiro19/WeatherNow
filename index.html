<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WeatherNow</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">WEATHERNOW</div>
    <div class="location-control">
      <span class="label">Buscar clima em</span>
      <input type="text" id="cityInput" placeholder="Digite a cidade" aria-label="Digite a cidade" />
      <button id="searchButton" class="btn">Buscar</button>
    </div>
    <div class="unit-toggle" role="group" aria-label="Unidades">
      <button class="unit active" data-unit="c">°C</button>
      <button class="unit" data-unit="f">°F</button>
    </div>
  </header>

  <main class="stage" id="result" class="result hidden">
    <div class="glass left-panel">
      <div class="now">
        <div class="sun-times">
          <div>Nascer do sol: <span id="sunrise">--:--</span></div>
          <div>Por do sol: <span id="sunset">--:--</span></div>
        </div>
        <div class="now-main">
          <div class="icon" id="weatherIcon">☀️</div>
          <div class="now-text">
            <div class="datetime" id="datetime">—</div>
            <div class="temp" id="temperature">--°</div>
            <div class="feels">Sensação térmica <span id="feelsLike">--°</span></div>
            <div class="city" id="cityName"></div>
            <div class="desc" id="description"></div>
          </div>
        </div>
        <div class="more-details">
          <div>Velocidade do vento: <span id="windspeed">--</span> m/s</div>
          <div>Humidade do ar: <span id="humidity">--</span>%</div>
          <div>Pressão: <span id="pressure">--</span> hPa</div>
          <div>Probabilidade de precipitação: <span id="precip">--</span>%</div>
        </div>
      </div>
    </div>

    <div class="glass right-panel">
      <h3>MAIS DETALHES</h3>
      <div class="hours" id="hoursStrip"></div>
    </div>
  </main>

  <section class="bottom-forecast">
    <div class="inner">
      <div class="title">PRÓXIMOS 7 DIAS</div>
      <div class="forecast-container" id="forecastContainer"></div>
    </div>
  </section>

  <!-- Consentimento de uso de dados locais (cache/localStorage) -->
  <div id="consentBanner" style="position:fixed;left:0;right:0;bottom:0;z-index:50;display:none">
    <div style="margin:0 auto;max-width:920px;padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;background:rgba(0,0,0,.85);color:#f2f2f2;border-top:1px solid rgba(255,255,255,.15)">
      <div style="font-size:14px;line-height:1.4">
        Este site usa armazenamento local para melhorar a experiência (cache de resultados). Você pode aceitar ou limpar o cache a qualquer momento.
      </div>
      <div style="display:flex;gap:8px;white-space:nowrap">
        <button id="clearCacheBtn" class="btn" style="background:transparent;color:#eee;border:1px solid rgba(255,255,255,.3)">Limpar cache</button>
        <button id="acceptConsentBtn" class="btn">Aceitar</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const CONSENT_KEY = 'consent:local';
      const hasConsent = (() => {
        try { return localStorage.getItem(CONSENT_KEY) === '1'; } catch { return false; }
      })();
      const banner = document.getElementById('consentBanner');
      const acceptBtn = document.getElementById('acceptConsentBtn');
      const clearBtn = document.getElementById('clearCacheBtn');

      function showBanner(){ banner.style.display = 'block'; }
      function hideBanner(){ banner.style.display = 'none'; }

      if (!hasConsent) showBanner();

      acceptBtn?.addEventListener('click', () => {
        try { localStorage.setItem(CONSENT_KEY, '1'); } catch {}
        hideBanner();
      });

      clearBtn?.addEventListener('click', () => {
        try {
          // Limpa chaves usadas pelo app: geo:*, weather:*
          const keys = Object.keys(localStorage);
          keys.forEach(k => { if (k.startsWith('geo:') || k.startsWith('weather:')) localStorage.removeItem(k); });
        } catch {}
        alert('Cache limpo.');
      });

      // Opcional: se desejar bloquear cache antes do consentimento, é possível
      // checar o CONSENT_KEY dentro do utilitário de cache no futuro.
    })();
  </script>

  <script src="app.js"></script>
</body>
</html>
